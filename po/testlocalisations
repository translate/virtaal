#!/bin/bash

./intltool-update --pot
podebug --rewrite=xxx -f "" --progress=none virtaal.pot de_DE.po
podebug --rewrite=xxx -f "" --ignore=gtk --progress=none gtk20-lite.pot de_DE-lite.po
podebug --rewrite=xxx -f "" --progress=none gtk-spell.pot de_DE-spell.po
for po in $(ls *.po | egrep -v lite)
do
	modir=mo/$(basename $po .po)/LC_MESSAGES
	gtklite=$(basename $po .po)-lite.po
	gtkreal=/usr/share/locale/$(basename $po .po)/LC_MESSAGES/gtk20.mo
	gtkspell=$(basename $po .po)-spell.po
	gtkspellreal=/usr/share/locale/$(basename $po .po)/LC_MESSAGES/gtkspell.mo
	mkdir -p $modir
	msgfmt -o $modir/virtaal.mo $po
        if [ -f $gtklite ]; then
		msgfmt -o $modir/gtk20.mo $gtklite
	elif [ -f $gtkreal ]; then
		cp $gtkreal $modir
	fi
        if [ -f $gtkspell ]; then
		msgfmt -o $modir/gtkspell.mo $gtkspell
	elif [ -f $gtkspellreal ]; then
		cp $gtkspellreal $modir
	fi
done

lang=$(echo $1 |sed "s/\.po$//")
export LANGUAGE=../../../../../../../../$(pwd)/mo/${lang:-de_DE}:$LANGUAGE
echo "LANGUAGE=$LANGUAGE"
# This assumes that the following executable is in your PATH
virtaal
